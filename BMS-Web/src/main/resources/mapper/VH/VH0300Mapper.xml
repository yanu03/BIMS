<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.tracom.brt.domain.VH0300.VH0300Mapper">

<select id="VH0300G0R0" resultType="Map">
	SELECT  
		B.REP_ROUT_NM
		,B.ROUT_NM
		,A.STTN_ID
		,A.NODE_NM
		,A.STTN_NO
	FROM
		BMS_ROUT_NODE_CMPSTN A
		LEFT JOIN BMS_ROUT_MST B
		ON A.ROUT_ID = B.ROUT_ID
	WHERE
		A.NODE_TYPE = 'NT002'
		<if test="@kr.tracom.util.CommonUtil@notEmpty(CONTENT1)">
			AND B.REP_ROUT_ID = #{CONTENT1}
		</if>
		<if test="@kr.tracom.util.CommonUtil@notEmpty(CONTENT2)">
			AND A.ROUT_ID = #{CONTENT2}
		</if>
		<if test="@kr.tracom.util.CommonUtil@notEmpty(CONTENT)">
			AND (A.STTN_ID LIKE CONCAT('%', #{CONTENT}, '%') || A.NODE_NM LIKE CONCAT('%',#{CONTENT},'%') || A.STTN_NO LIKE CONCAT('%',#{CONTENT},'%'))
		</if>
	ORDER BY
		B.REP_ROUT_ID, A.ROUT_ID, A.STTN_ID
	</select>

	<select id="VH0300SHI0" resultType="Map" parameterType="Map">
		SELECT STTN_ID, STTN_NM
		FROM
			BMS_STTN_MST
		WHERE DEL_YN!='Y'
	</select>
	
	<select id="VH0300G1R0" resultType="Map">
		SELECT  
			DATE_FORMAT(A.OCR_DTM, '%Y-%m-%d %h:%i:%s') OCR_DTM 
			,A.VHC_NO
			,A.DOOR_SN
			,A.LOC_STOP_DIV
		FROM 	
			BRT_ACRT_LOC_STOP_LOG A
			LEFT JOIN BMS_STTN_MST B
			ON A.STTN_ID = B.STTN_ID AND B.DEL_YN!='Y'
		WHERE
			B.STTN_ID = #{STTN_ID}
		<if test="@kr.tracom.util.CommonUtil@notEmpty(CONTENT3)">
			AND A.VHC_NO LIKE CONCAT('%', #{CONTENT3}, '%')
		</if>
		<if test="@kr.tracom.util.CommonUtil@notEmpty(F_DATE) and @kr.tracom.util.CommonUtil@empty(L_DATE)">
			<![CDATA[AND DATE_FORMAT(A.OCR_DTM, '%Y%m%d') >= #{F_DATE}]]>
		</if>
		<if test="@kr.tracom.util.CommonUtil@notEmpty(L_DATE) and @kr.tracom.util.CommonUtil@empty(F_DATE)">
			<![CDATA[AND DATE_FORMAT(A.OCR_DTM, '%Y%m%d') <= #{L_DATE}]]>
		</if>
		<if test="@kr.tracom.util.CommonUtil@notEmpty(F_DATE) and @kr.tracom.util.CommonUtil@notEmpty(L_DATE)">
			AND DATE_FORMAT(A.OCR_DTM, '%Y%m%d') BETWEEN #{F_DATE} AND #{L_DATE}
		</if>
	</select>
	
	<delete id="VH0300G1D0" parameterType="Map">
		DELETE FROM BRT_ACRT_LOC_STOP_LOG
		WHERE OCR_DTM = #{OCR_DTM}
	</delete>

<!--  <insert id="VI0100G1I0" parameterType="Map">
	insert into BRT_OPER_VIOLT_HIS
			(STTN_ID,
			TRNS_ID,
			TRNS_DIV,
			TRNS_NM,
			GPS_X,
			GPS_Y,
			TM_Y,
			TM_X,
			USE_YN,
			REMARK,
			UPD_DTM,
			UPD_ID
			)
	values (#{STTN_ID},
			#{TRNS_ID},
			#{TRNS_DIV},
			#{TRNS_NM},
			#{GPS_X},
			#{GPS_Y},
			0,
			0,
			#{USE_YN},
			#{REMARK},
			#{UPD_DTM},
			#{SSN_USER_ID}
			)		

</insert>-->

</mapper>
